// target elements in HTML
const preview = document.getElementById("preview");
const imgInfo = document.getElementById("imgInfo");

let currentImage = null;
let currentImageBlob = null;

// fungsi dipanggil dari HTML setelah upload file
export function setUploadedImage(imgEl, blob) {
    currentImage = imgEl;
    currentImageBlob = blob;
}

// grayscale function similar to Python version
export function convertToGrayscale() {
    if (!currentImage) {
        alert("Upload gambar dulu.");
        return;
    }

    const img = currentImage;

    // Sama seperti Python: resize ke 128x128
    const resizeW = 128;
    const resizeH = 128;

    // buat canvas sementara
    const canvas = document.createElement("canvas");
    canvas.width = resizeW;
    canvas.height = resizeH;

    const ctx = canvas.getContext("2d");

    // gambar + resize seperti cv2.resize INTER_AREA
    ctx.drawImage(img, 0, 0, resizeW, resizeH);

    const imageData = ctx.getImageData(0, 0, resizeW, resizeH);
    const data = imageData.data;

    // grayscale (r + g + b) / 3 — sama seperti code Python Anda
    for (let i = 0; i < data.length; i += 4) {
        const gray = Math.round((data[i] + data[i + 1] + data[i + 2]) / 3);
        data[i] = gray;        // R
        data[i + 1] = gray;    // G
        data[i + 2] = gray;    // B
    }

    ctx.putImageData(imageData, 0, 0);

    // ubah canvas ke Blob lalu tampilkan
    canvas.toBlob((blob) => {
        const url = URL.createObjectURL(blob);

        preview.innerHTML = "";
        const newImg = document.createElement("img");
        newImg.src = url;
        preview.appendChild(newImg);

        currentImage = newImg;
        currentImageBlob = blob;

        newImg.onload = () => {
            imgInfo.textContent =
                `Ukuran: ${newImg.naturalWidth}×${newImg.naturalHeight} • ` +
                `Tipe: ${bl
